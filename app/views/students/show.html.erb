<section class="client">
  <div class="container-fluid">
    <div class="card">
      <div class="card-close">
        <%= link_to 'Editar', edit_student_path(@student), class: 'btn btn-primary' %>
      </div>
      <div class="card-body text-center">
        <div class="client-avatar">
          <img src="http://i.pravatar.cc/300" alt="..." class="img-fluid rounded-circle">
        </div>
        <div class="client-title">
          <h3><%= @student.name %></h3>
          <% if @student.city %>
            <span><%= "#{@student.city.name}/#{@student.state.acronym}" %></span>
          <% end %>
          <% unless @student.phone_numbers.empty? %>
            <span><%= @student.phone_numbers.first %></span>
          <% end %>
        </div>
        <hr>
        <div class="client-info">
          <div class="row">
            <div class="col-4">
              <strong><%= @student.medicines.count %></strong><br>
              <small>Medicamentos</small>
            </div>
            <div class="col-4">
              <strong><%= @student.appointments.count %></strong><br>
              <small>Agendamentos</small>
            </div>
            <div class="col-4">
              <strong>235</strong><br>
              <small>Tasks</small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="container-fluid">
    <div class="card">
      <div class="card-close">
        <%= button_tag 'Adicionar medicamento', class: 'btn btn-sm btn-primary', data: { toggle: 'modal', target: '#medicine-modal' } %>
      </div>
      <div class="card-header d-flex align-items-center">
        <h3>Medicamentos</h3>
      </div>
      <div class="card-body">
        <% unless @student.medicines.empty? %>
          <table class="table table-hover">
          <thead>
            <tr>
              <th>Nome</th>
              <th>Dosagem</th>
              <th>Intervalo</th>
              <th>Data de cadastro</th>
              <th colspan="3"></th>
            </tr>
          </thead>
          <tbody>
            <%= render @student.medicines %>
          </tbody>
        </table>
        <% else %>
          <h4 class="text-center">Nenhum medicamento cadastrado.</h4>
        <% end %>
      </div>
    </div>
  </div>
  <div class="container-fluid">
    <div class="card">
      <div class="card-close">
        <%= button_tag 'Adicionar agendamento', class: 'btn btn-sm btn-primary', data: { toggle: 'modal', target: '#appointment-modal' } %>
      </div>
      <div class="card-header d-flex align-items-center">
        <h3>Agendamentos</h3>
      </div>
      <div class="card-body">
        <% unless @appointments.empty? %>
          <table class="table table-hover">
          <thead>
            <tr>
              <th>Funcionário</th>
              <th>Data</th>
              <th>Horário</th>
              <th colspan="3"></th>
            </tr>
          </thead>
          <tbody>
            <% @appointments.each do |appointment| %>
              <tr>
                <td><%= appointment.user.name %></td>
                <td><%= l appointment.date, format: :long %></td>
                <td><%= l appointment.time, format: '%H:%m' %></td>
                <td>
                  <%= link_to student_appointments_path(appointment), method: 'delete', class: 'btn btn-sm', data: { confirm: 'Tem certeza que deseja excluir?' } do %>
                    <%= icon('trash') %> Excluir
                  <% end %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
        <% else %>
          <h4 class="text-center">Nenhum agendamento cadastrado.</h4>
        <% end %>
      </div>
    </div>
</section>

<%= render 'modal/medicine', medicine: @student.medicines.build %>
<%= render 'modal/student_appointment', appointment: @student.appointments.build %>
