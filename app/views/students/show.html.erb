<section class="client">
  <div class="container-fluid">
    <div class="card">
      <div class="card-close">
        <%= link_to 'Editar', edit_student_path(@student), class: 'btn btn-primary' %>
      </div>
      <div class="card-body text-center">
        <div class="client-avatar">
          <%= image_tag 'avatar', class: 'img-fluid rounded-circle' %>
        </div>
        <div class="client-title">
          <h3><%= @student.name %></h3>
          <% if @student.city %>
            <span><%= "#{@student.city.name}/#{@student.state.acronym}" %></span>
          <% end %>
          <% unless @student.phone_numbers.empty? %>
            <span><%= @student.phone_numbers.first %></span>
          <% end %>
        </div>
        <hr>
        <div class="client-info">
          <div class="row">
            <div class="col-4">
              <strong><%= @student.medicines.count %></strong><br>
              <small>Medicamentos</small>
            </div>
            <div class="col-4">
              <strong><%= @student.dietary_restrictions.count %></strong><br>
              <small>Restrições Alimentares</small>
            </div>
            <div class="col-4">
              <strong><%= @student.appointments.count %></strong><br>
              <small>Agendamentos</small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="container-fluid">
    <div class="card">
      <div class="card-close">
        <%= button_tag 'Adicionar medicamento', class: 'btn btn-sm btn-primary', data: { toggle: 'modal', target: '#medicine-modal' } %>
      </div>
      <div class="card-header d-flex align-items-center">
        <h3>Medicamentos</h3>
      </div>
      <div class="card-body">
        <% unless @student.medicines.empty? %>
          <table class="table table-hover">
          <thead>
            <tr>
              <th>Nome</th>
              <th>Dosagem</th>
              <th>Intervalo</th>
              <th>Data de cadastro</th>
              <th colspan="3"></th>
            </tr>
          </thead>
          <tbody>
            <%= render @student.medicines %>
          </tbody>
        </table>
        <% else %>
          <h4 class="text-center">Nenhum medicamento cadastrado.</h4>
        <% end %>
      </div>
    </div>
  </div>
  <div class="container-fluid">
    <div class="card">
      <div class="card-close">
        <%= button_tag 'Adicionar responsável', class: 'btn btn-sm btn-primary', data: { toggle: 'modal', target: '#responsible-modal' } %>
      </div>
      <div class="card-header d-flex align-items-center">
        <h3>Responsáveis</h3>
      </div>
      <div class="card-body">
        <% unless @student.student_responsibles.empty? %>
          <table class="table table-hover">
          <thead>
            <tr>
              <th>Nome</th>
              <th>Data de nascimento</th>
              <th>Telefone</th>
              <th>RG</th>
              <th>CPF</th>
              <th>Sexo</th>
              <th colspan="3"></th>
            </tr>
          </thead>
          <tbody>
            <%= render @student.student_responsibles %>
          </tbody>
        </table>
        <% else %>
          <h4 class="text-center">Nenhum medicamento cadastrado.</h4>
        <% end %>
      </div>
    </div>
  </div>
  <div class="container-fluid">
    <div class="card">
      <div class="card-close">
        <%= button_tag 'Adicionar restrição alimentar', class: 'btn btn-sm btn-primary', data: { toggle: 'modal', target: '#dietary_restriction-modal' } %>
      </div>
      <div class="card-header d-flex align-items-center">
        <h3>Restrições Alimentares</h3>
      </div>
      <div class="card-body">
        <% unless @student.dietary_restrictions.empty? %>
          <table class="table table-hover">
          <thead>
            <tr>
              <th>Restrição</th>
              <th>Data de cadastro</th>
              <th colspan="3"></th>
            </tr>
          </thead>
          <tbody>
            <%= render @student.dietary_restrictions %>
          </tbody>
        </table>
        <% else %>
          <h4 class="text-center">Nenhuma restrição alimentar cadastrada.</h4>
        <% end %>
      </div>
    </div>
  </div>
  <div class="container-fluid">
    <div class="card">
      <div class="card-close">
        <%= button_tag 'Adicionar agendamento', class: 'btn btn-sm btn-primary', data: { toggle: 'modal', target: '#appointment-modal' } %>
      </div>
      <div class="card-header d-flex align-items-center">
        <h3>Agendamentos</h3>
      </div>
      <div class="card-body">
        <% unless @appointments.empty? %>
          <table class="table table-hover">
          <thead>
            <tr>
              <th>Funcionário</th>
              <th>Data</th>
              <th>Horário</th>
              <th colspan="3"></th>
            </tr>
          </thead>
          <tbody>
            <%= render @appointments %>
          </tbody>
        </table>
        <% else %>
          <h4 class="text-center">Nenhum agendamento cadastrado.</h4>
        <% end %>
      </div>
    </div>
</section>

<%= render 'modal/medicine', medicine: @student.medicines.build %>
<%= render 'modal/dietary_restriction', dietary_restriction: @student.dietary_restrictions.build %>
<%= render 'modal/student_appointment', appointment: @student.appointments.build %>
<%= render 'modal/student_responsible', student_responsible: @student.student_responsibles.build %>
